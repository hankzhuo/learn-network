## 加密

加密分为**对称加密** 和 **非对称加密**。

对称加密算法中，加密和解密使用的密钥是相同的。

非对称加密使用的秘钥是不同的，有公钥和私钥。非对称加密使用公钥加密，私钥解密。

对称加密比非对称加密算来说，效率要高，性能也好。但对称加密有个缺点，不好约定秘钥，只能线下传输。

## 数字证书

生成证书需要发起一个证书请求，然后将这个请求发给一个权威机构去认证，这个机构称为 CA（Certificate Authority）。CA 用自己的私钥通过**签名算法**给一个证书盖章。

证书请求可以通过这个命令生成：

`openssl req -key cliu8siteprivate.key -new -out cliu8sitecertificate.req`

签名算法大概是这样工作的：一般是对信息（证书所有者、发布机构、有效日期等信息）做一个 Hash 计算，得到一个 Hash 值，这个过程是不可逆的，也就是说无法通过 Hash 值得出原来的信息内容。在把信息发送出去时，把这个 Hash 值加密后，作为一个签名和信息一起发出去。

证书认证后，证书中包含 Hash 值和签名。

## HTTPS 工作模式

非对称加密在性能上不如对称加密，那是否能将两者结合起来呢？例如，公钥私钥主要用于传输对称加密的秘钥，而真正的双方大数据量的通信都是通过对称加密进行的。

![](leanote://file/getImage?fileId=5d6537def9c44353ed000000)

HTTPS 通讯步骤 SSL：
1. 客户端发起加密通讯请求，这个请求叫作 Client Hello，并且告诉服务端自己支持的协议版本、加密算法、压缩算法、以及一个随机数 A
2. 服务端响应客户端，告知客户端自己加协议版本、加密算法、一个随机数 B、证书
3. 客户端收到服务端响应后，首先会检查证书的颁发者是否可信任、是否过期、域名是否一致，并且从操作系统中拿出证书链中该证书的上一级证书，校验服务端证书公钥和 Hash 信息，如果校验失败，则提示网站有风险。如果校验成功，客户端会项服务端发送一个 pre-master-key 随机数，该数字用证书中公钥加密，在发送给服务器，服务器通过私钥解密出来。
4. 客户端和服务端通过随机数 A、B、pre-master-key 一起计算出密钥。
5. 有了对称密钥，客户端会告诉服务端以后用密钥和加密算法进行加密通讯了。
6. 客户端会发送一条 Encrypted Handshake Message，将商定好的参数等，采用协商密钥进行加密，发送给服务端用于数据和握手验证。

上述过程，只包含了 HTTPS 的单向验证，也就是客户端验证服务端的证书。在更加严格条件下，会启用双向认证，互相验证对方证书。